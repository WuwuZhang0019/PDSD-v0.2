实现直观的用户界面，支持拖拽、连接和实时编辑：

```rust
impl eframe::App for PowerDistributionApp {
    fn update(&mut self, ctx: &egui::Context, frame: &mut eframe::Frame) {
        egui::SidePanel::left("node_palette").show(ctx, |ui| {
            ui.heading("组件库");

            // 配电回路节点
            ui.collapsing("配电回路", |ui| {
                if ui.button("单相配电回路").clicked() {
                    self.add_circuit_node(CircuitType::SinglePhase);
                }
                if ui.button("三相配电回路").clicked() {
                    self.add_circuit_node(CircuitType::ThreePhase);
                }
            });

            // 配电箱节点
            ui.collapsing("配电箱", |ui| {
                if ui.button("标准配电箱").clicked() {
                    self.add_distribution_box_node();
                }
            });

            // 干线系统图节点
            ui.collapsing("干线系统", |ui| {
                if ui.button("干线系统图").clicked() {
                    self.add_main_system_node();
                }
            });
        });

        // 主编辑区域
        egui::CentralPanel::default().show(ctx, |ui| {
            egui::ScrollArea::both().show(ui, |ui| {
                let mut response = egui_node_graph::draw_graph_editor(
                    ui,
                    &mut self.graph,
                    &mut self.editor_state,
                    &mut PowerDistributionNodeTemplateProvider {},
                    &mut PowerDistributionWidgetValueProvider {},
                );

                // 处理节点选择
                if let Some(selected_node) = response.selected_node {
                    self.show_node_properties(ui, selected_node);
                }

                // 处理连接创建
                if let Some((from, to)) = response.created_connection {
                    self.handle_new_connection(from, to);
                }

                // 处理节点移动
                if let Some(moved_nodes) = response.moved_nodes {
                    for node_id in moved_nodes {
                        // 可以添加特殊处理，如配电回路节点拖入配电箱的逻辑
                        if let Some(target_box) = self.check_if_node_dropped_into_box(node_id) {
                            self.move_circuit_to_box(node_id, target_box);
                        }
                    }
                }

                // 处理节点删除
                if let Some(deleted_node) = response.deleted_node {
                    self.handle_node_deletion(deleted_node);
                }
            });
        });

        // 右侧属性面板
        egui::SidePanel::right("properties").show(ctx, |ui| {
            ui.heading("属性编辑");
            // 属性编辑内容在show_node_properties中处理
        });

        // 底部状态栏
        egui::TopBottomPanel::bottom("status_bar").show(ctx, |ui| {
            ui.horizontal(|ui| {
                ui.label(format!("节点数: {}", self.graph.nodes.len()));
                ui.label(format!("连接数: {}", self.graph.connections.len()));
            });
        });
    }
}

// 检查节点是否拖入配电箱
impl PowerDistributionApp {
    fn check_if_node_dropped_into_box(&self, node_id: egui_node_graph::NodeId) -> Option<egui_node_graph::NodeId> {
        // 1. 获取被移动节点的位置
        let node_pos = self.editor_state.node_positions.get(&node_id)?;

        // 2. 检查是否在某个配电箱节点范围内
        for (box_id, box_node) in &self.graph.nodes {
            if let Some(box_pos) = self.editor_state.node_positions.get(box_id) {
                if let PowerNodeData::DistributionBox(_) = &box_node.user_data {
                    // 简化处理，实际应用中应检查精确的边界
                    if (node_pos.0 - box_pos.0).abs() < 100.0 &&
                       (node_pos.1 - box_pos.1).abs() < 100.0 {
                        return Some(*box_id);
                    }
                }
            }
        }

        None
    }

    // 移动配电回路到配电箱
    fn move_circuit_to_box(&mut self, circuit_id: egui_node_graph::NodeId, box_id: egui_node_graph::NodeId) {
        // 1. 检查节点类型
        if !matches!(&self.graph.nodes[circuit_id].user_data, PowerNodeData::Circuit(_)) ||
           !matches!(&self.graph.nodes[box_id].user_data, PowerNodeData::DistributionBox(_)) {
            return;
        }

        // 2. 创建连接
        let circuit_output_id = *self.graph.nodes[circuit_id].outputs.values().next()?;
        let box_input_id = *self.graph.nodes[box_id].inputs.values().next()?;

        self.graph.connections.insert(box_input_id, circuit_output_id);

        // 3. 标记节点需要更新
        self.nodes_to_update.insert(box_id);

        // 4. 触发更新传播
        self.propagate_updates();
    }

    // 显示节点属性
    fn show_node_properties(&mut self, ui: &mut egui::Ui, node_id: egui_node_graph::NodeId) {
        if let Some(node) = self.graph.nodes.get_mut(node_id) {
            match &mut node.user_data {
                PowerNodeData::Circuit(circuit) => {
                    ui.heading("配电回路属性");
                    ui.add(egui::Slider::new(&mut circuit.power, 0.1..=100.0).text("功率 (kW)"));
                    if ui.button("更新计算").clicked() {
                        circuit.calculate_current();
                        circuit.select_components();

                        // 标记下游节点需要更新
                        self.nodes_to_update.insert(node_id);
                        self.propagate_updates();
                    }

                    // 显示计算结果
                    ui.group(|ui| {
                        ui.label(format!("计算电流: {:.2} A", circuit.current));
                        ui.label(format!("1.1倍电流: {:.2} A", circuit.current_1_1x));
                        ui.label(format!("1.25倍电流: {:.2} A", circuit.current_1_25x));
                        ui.label(format!("元器件类型: {}", circuit.component_type));
                        ui.label(format!("元器件电流: {:.0} A", circuit.component_current));
                        ui.label(format!("线缆规格: {}", circuit.cable_spec));
                        if let Some(phase) = circuit.phase {
                            ui.label(format!("相序: {}", phase));
                        }
                        ui.label(format!("回路编号: {}", circuit.circuit_number));
                    });
                },
                PowerNodeData::DistributionBox(box_node) => {
                    ui.heading("配电箱属性");
                    ui.text_edit_singleline(&mut box_node.name);
                    ui.add(egui::Slider::new(&mut box_node.floor, 1..=50).text("所在楼层"));

                    // 显示计算结果
                    ui.group(|ui| {
                        ui.label(format!("总功率: {:.2} kW", box_node.total_power));
                        ui.label(format!("总电流: {:.2} A", box_node.total_current));
                        ui.label(format!("进线保护电流: {:.0} A", box_node.incoming_current));
                        ui.label(format!("L1相负载: {:.2} kW", box_node.phase_loads[0]));
                        ui.label(format!("L2相负载: {:.2} kW", box_node.phase_loads[1]));
                        ui.label(format!("L3相负载: {:.2} kW", box_node.phase_loads[2]));
                    });

                    // 三相平衡控制
                    if ui.button("重新平衡三相").clicked() {
                        // 实现重新平衡逻辑
                        self.nodes_to_update.insert(node_id);
                        self.propagate_updates();
                    }
                },
                PowerNodeData::MainSystem(system_node) => {
                    ui.heading("干线系统图属性");
                    ui.checkbox(&mut system_node.auto_layout, "自动布局");

                    // 系统类型选择
                    ui.label("包含系统图:");
                    ui.checkbox(&mut system_node.systems.contains(&MainSystemType::PowerDistribution), "配电干线图");
                    ui.checkbox(&mut system_node.systems.contains(&MainSystemType::EnergyMonitoring), "能耗监测干线图");
                    ui.checkbox(&mut system_node.systems.contains(&MainSystemType::ElectricalFireMonitoring), "电气火灾监控干线图");
                    ui.checkbox(&mut system_node.systems.contains(&MainSystemType::FirePowerMonitoring), "消防电源监测干线图");

                    if ui.button("更新系统图").clicked() {
                        self.nodes_to_update.insert(node_id);
                        self.propagate_updates();
                    }
                },
            }
        }
    }
}
```