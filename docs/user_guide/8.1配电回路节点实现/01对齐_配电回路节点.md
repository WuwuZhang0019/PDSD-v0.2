# 配电回路节点功能对齐文档

## 1. 原始需求

根据 `docs/user_guide/项目开发指南/8.1配电回路节点实现.md` 文档，配电回路节点是系统的基本构成单元，分为单相和三相两种类型。

## 2. 需求理解

配电回路节点需要实现以下功能：

1. **回路类型支持**：支持单相和三相两种电路类型
2. **回路用途分类**：包括照明、动力、空调、特殊和自定义用途
3. **电气参数**：功率、电压、电流计算
4. **电流衍生值**：计算1.1倍和1.25倍计算电流
5. **智能选型功能**：
   - 自动选择元器件电流整定值
   - 根据回路用途选择元器件类型
   - 自动选择线缆规格
6. **相位信息**：记录相序信息（L1, L2, L3）
7. **回路编号**：管理回路编号

## 3. 项目架构理解

基于项目现有架构，配电回路节点应：

1. 继承自系统的基础节点类型
2. 与现有的计算引擎集成，使用标准电气计算公式
3. 实现节点编辑器所需的接口和特性
4. 与配电箱节点和干线节点形成完整的数据流向

## 4. 边界确认

1. **计算范围**：仅处理基本的电流计算和元器件选型
2. **集成边界**：作为独立节点类型，需要与系统的节点模板、数据类型和UI渲染兼容
3. **扩展边界**：设计应考虑未来可能的扩展，如增加更多回路类型或特殊计算需求

## 5. 疑问澄清

1. 回路节点与配电箱节点的具体数据交互方式需要进一步明确
2. 是否需要支持多种电压等级（不仅限于220V和380V）
3. 元器件选型表是否需要从外部配置文件加载
4. 回路节点的UI展示方式和编辑界面设计需要确认

## 6. 电气计算标准确认

根据项目规范，电气计算应遵循以下标准：

1. **单相电流计算**：Ijs = Pe * Kx / U / Cos（U=0.22kV）
2. **三相电流计算**：Ijs = Pe * Kx / U / Cos / √3（U=0.38kV）
3. 功率因数默认值为0.85（可配置）

## 7. 与现有系统集成

1. 需要遵循现有的 `PowerGraphNode` 数据结构
2. 需要实现 `NodeTemplateTrait` 接口
3. 需要与 `CurrentCalculationEngine` 集成
4. 需要在节点查找器中正确分类和展示
5. 需要支持序列化和反序列化

## 8. 验收标准

1. 回路节点能正确计算电流值
2. 元器件选型功能按预期工作
3. 节点能正确集成到现有系统
4. 支持基本的增删改查操作
5. 计算结果符合电气规范
6. 代码通过单元测试